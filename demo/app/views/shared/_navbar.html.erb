<nav class="navbar navbar-expand-lg navbar-light fixed-top bg-white shadow-sm py-3">
  <div class="container">
    <%= link_to root_path, class: "navbar-brand d-flex align-items-center" do %>
      <i class="bi bi-calendar-check me-2 fs-4"></i>
      <span class="fw-bold text-primary fs-4">cz活动系统</span>
    <% end %>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <%= link_to root_path, class: "nav-link fs-5 #{'active fw-bold' if current_page?(root_path)}" do %>
            <i class="bi bi-house-door me-1"></i>首页
          <% end %>
        </li>
        <li class="nav-item">
          <%= link_to events_path, class: "nav-link fs-5 #{'active fw-bold' if controller_name == 'events'}" do %>
            <i class="bi bi-grid me-1"></i>所有活动
          <% end %>
        </li>

        

        <% if Current.user %>
          <% if Current.user.student? %>
            <li class="nav-item">
              <%= link_to participated_events_user_path(Current.user), 
                    class: "nav-link fs-5 #{'active fw-bold' if action_name == 'participated_events'}" do %>
                <i class="bi bi-calendar2-check me-1"></i>我参加的活动
              <% end %>
            </li>
            <li class="nav-item">
              <%= link_to volunteer_positions_user_path(Current.user),
                    class: "nav-link fs-5 #{'active fw-bold' if action_name == 'volunteer_positions'}" do %>
                <i class="bi bi-person-workspace me-1"></i>我的岗位申请
              <% end %>
            </li>
          <% else %>
            <li class="nav-item">
              <%= link_to organized_events_user_path(Current.user),
                    class: "nav-link fs-5 #{'active fw-bold' if action_name == 'organized_events'}" do %>
                <i class="bi bi-calendar2-plus me-1"></i>我组织的活动
              <% end %>
            </li>
            <% if Current.user.teacher? %>
              <li class="nav-item">
                <%= link_to associated_events_user_path(Current.user),
                      class: "nav-link fs-5 #{'active fw-bold' if action_name == 'associated_events'}" do %>
                  <i class="bi bi-calendar2-event me-1"></i>我关联的活动
                <% end %>
              <li class="nav-item">
                <%= link_to applications_path, class: "nav-link fs-5 #{'active fw-bold' if controller_name == 'applications'}" do %>
                  <i class="bi bi-file-text me-1"></i>我的申请
                <% end %>
              </li>
              </li>
            <% else %>
              <li class="nav-item">
                <%= link_to applications_path, class: "nav-link fs-5 #{'active fw-bold' if controller_name == 'applications'}" do %>
                  <i class="bi bi-files me-1"></i>活动申请管理
                <% end %>
              </li>
            <% end %>
          <% end %>
        <% end %>

        <% if Current.user %>
          <% if Current.user.admin? %>
            <li class="nav-item">
              <%= link_to users_path, class: "nav-link fs-5 #{'active fw-bold' if controller_name == 'users'}" do %>
                <i class="bi bi-people me-1"></i>用户管理
              <% end %>
            </li>
          <% end %>
        <% end %>
      </ul>

      <ul class="navbar-nav align-items-center">
        <% if Current.user %>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center fs-5" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
              <i class="bi bi-person-circle me-1"></i>
              <span>欢迎，<%= Current.user.username %></span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow-sm">
              <%= link_to user_path(Current.user), class: "dropdown-item" do %>
                <i class="bi bi-person me-2"></i>个人资料
              <% end %>
              <div class="dropdown-divider"></div>
              <%= button_to Current.session, 
                  method: :delete, 
                  class: "dropdown-item text-danger",
                  form: { class: "d-inline" } do %>
                <i class="bi bi-box-arrow-right me-2"></i>登出
              <% end %>
            </ul>
          </li>
          <li class="nav-item">
            <%= link_to notifications_path, class: "nav-link position-relative" do %>
              <i class="bi bi-bell fs-4"></i>
              <% if (count = Current.user.unread_notifications_count) > 0 %>
                <span class="position-absolute top-3 start-100 translate-middle badge rounded-pill bg-danger">
                  <%= count %>
                </span>
              <% end %>
            <% end %>
          </li>
        <% else %>
          <li class="nav-item d-flex align-items-center">
            <%= link_to sign_in_path, class: "nav-link fs-5" do %>
              <i class="bi bi-box-arrow-in-right me-1"></i>登录
            <% end %>
          </li>
          <li class="nav-item ms-2">
            <%= link_to sign_up_path, class: "btn btn-primary px-4 py-2 fs-5" do %>
              <i class="bi bi-person-plus me-1"></i>注册
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</nav>
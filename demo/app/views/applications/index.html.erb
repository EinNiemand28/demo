<div class="container mt-5">
  <div class="card shadow-sm">
    <div class="card-body p-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="d-flex align-items-center gap-3">
          <h4 class="card-title mb-0">
            <i class="bi bi-files me-2"></i>活动申请列表
          </h4>
          <div class="btn-group">
            <%= link_to applications_path, 
                  class: "btn btn-outline-secondary #{params[:status].blank? ? 'active' : ''}" do %>
              全部
            <% end %>
            <% Application.statuses.each do |status, _| %>
              <%= link_to applications_path(status: status), 
                    class: "btn btn-outline-secondary #{params[:status] == status ? 'active' : ''}" do %>
                <%= application_status(status) %>
              <% end %>
            <% end %>
          </div>
        </div>
        
        <% if Current.user.teacher? %>
          <%= link_to new_application_path, class: "btn btn-primary" do %>
            <i class="bi bi-plus-lg me-1"></i>新建申请
          <% end %>
        <% end %>
      </div>

      <% if @applications.any? %>
        <div class="table-responsive">
          <table class="table table-hover align-middle text-center">
            <thead class="table-light">
              <tr>
                <th>活动标题</th>
                <th>申请人</th>
                <th>申请时间</th>
                <th>状态</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <% @applications.each do |application| %>
                <tr>
                  <td><%= application.title %></td>
                  <td>
                    <%= link_to application.applicant.username,
                          user_path(application.applicant),
                          class: "text-decoration-none" %>
                  </td>
                  <td><%= l application.created_at, format: :short %></td>
                  <td>
                    <span class="badge <%= application_status_badge_class(application.status) %>">
                      <%= application_status(application.status) %>
                    </span>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <%= link_to application_path(application),
                            class: "btn btn-outline-primary" do %>
                        <i class="bi bi-eye"></i> <span>查看</span>
                      <% end %>

                      <% if application.applicant == Current.user && application.rejected? %>
                        <%= link_to edit_application_path(application),
                              class: "btn btn-outline-warning" do %>
                          <i class="bi bi-pencil"></i> <span>修改</span>
                        <% end %>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <div class="d-flex justify-content-center mt-4">
          <%= paginate @applications %>
        </div>
      <% else %>
        <div class="text-center py-5">
          <i class="bi bi-file-earmark-x text-muted" style="font-size: 4rem;"></i>
          <h5 class="mt-3 text-muted">暂无申请记录</h5>
        </div>
      <% end %>
    </div>
  </div>
</div>
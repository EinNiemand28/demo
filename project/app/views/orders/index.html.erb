<div class="container mt-5">
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="card-title mb-0">
          <i class="bi bi-receipt me-2"></i>
          <%= Current.user.admin? || Current.user.worker? ? "订单管理" : "我的订单" %>
        </h4>
        
        <div class="btn-group">
          <div class="btn-group">
            <%= link_to "全部订单", 
                  orders_path, 
                  class: "btn btn-outline-secondary #{params[:status].nil? ? 'active' : ''}" %>
            
            <% Order.statuses.each do |status, _value| %>
              <%= link_to t("statuses.#{status}"), 
                    orders_path(status: status), 
                    class: "btn btn-outline-secondary #{params[:status] == status ? 'active' : ''}" %>
            <% end %>
          </div>
        </div>
      </div>

      <% if @orders.any? %>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>订单号</th>
                <% if Current.user.admin? || Current.user.worker? %>
                  <th>用户</th>
                <% end %>
                <th>金额</th>
                <th>状态</th>
                <th>创建时间</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <% @orders.each do |order| %>
                <tr>
                  <td><%= order.id %></td>
                  <% if Current.user.admin? || Current.user.worker? %>
                    <td>
                      <%= link_to user_path(order.user) do %>
                        <span class="btn btn-sm btn-primary">
                          <%= order.user.username %>
                        </span>
                      <% end %>
                    </td>
                  <% end %>
                  <td class="text-danger">¥<%= number_with_precision(order.total_amount, precision: 2) %></td>
                  <td>
                    <span class="badge <%= order_status_badge_class(order.status) %>">
                      <%= t("statuses.#{order.status}") %>
                    </span>
                  </td>
                  <td><%= l order.created_at, format: :short %></td>
                  <td>
                    <%= link_to order_path(order), class: "btn btn-sm btn-outline-primary" do %>
                      <i class="bi bi-eye"></i> 查看
                    <% end %>
                    <% if order.can_delete? || Current.user.admin? || Current.user.worker? %>
                      <%= button_to order_path(order), 
                            method: :delete,
                            class: "btn btn-sm btn-outline-danger",
                            form: { class: 'd-inline-block ms-1' },
                            data: { 
                              turbo_confirm: '确定要删除此订单吗？',
                              action: "delete-order"
                            } do %>
                        <i class="bi bi-trash"></i> 删除
                      <% end %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        
        <div class="d-flex justify-content-center mt-4">
          <%= paginate @orders %>
        </div>
      <% else %>
        <div class="text-center py-5">
          <i class="bi bi-receipt text-muted" style="font-size: 4rem;"></i>
          <h5 class="mt-3 text-muted">暂无订单</h5>
        </div>
      <% end %>
    </div>
  </div>
</div>